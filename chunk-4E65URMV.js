import{b as Y,c as h,d as H,e as J,g as K,i as W,j as X,p as Z,r as ee}from"./chunk-UDLBRQ3V.js";import{b as U}from"./chunk-SN6GRNMG.js";import{$ as a,A as x,Aa as G,Da as L,E as l,Ga as Q,Ia as q,J as m,L as f,M as S,N as E,O as s,Q as k,R as O,S as n,T as t,U as u,V as v,W as y,X as c,Y as P,Z as M,_ as N,aa as p,ba as g,ca as A,e as F,g as I,ha as z,i as T,ia as w,la as B,m as R,n as C,na as D,u as _,v as V,wa as $,z as b,za as j}from"./chunk-NIPSTPOT.js";var ae=["ratingInput"],re=(i,o)=>o.id,ie=()=>[1,2,3,4,5];function oe(i,o){i&1&&(n(0,"div",1)(1,"div",4)(2,"span",5),a(3,"Loading..."),t()()())}function le(i,o){if(i&1&&(n(0,"div",2),a(1),t()),i&2){let e=c();l(),g(" ",e.error," ")}}function ce(i,o){i&1&&(u(0,"span",39),a(1," Approving... "))}function de(i,o){i&1&&(n(0,"span",20),a(1,"check_circle"),t(),a(2," Approve Beneficiary "))}function me(i,o){if(i&1){let e=v();n(0,"button",38),y("click",function(){b(e);let d=c(2);return x(d.approveBeneficiary(d.beneficiary.id))}),m(1,ce,2,0)(2,de,3,0),t()}if(i&2){let e=c(2);f("disabled",e.approving),l(),s(e.approving?1:2)}}function se(i,o){i&1&&(n(0,"div",41)(1,"span",53),a(2,"check_circle"),t(),a(3," Your rating has been submitted successfully! "),t())}function pe(i,o){if(i&1&&(n(0,"div",42)(1,"span",54),a(2,"error_outline"),t(),a(3),t()),i&2){let e=c(3);l(3),g(" ",e.ratingError," ")}}function fe(i,o){if(i&1){let e=v();n(0,"span",55),y("click",function(){let d=b(e).$implicit,ne=c(3);return x(ne.setRating(d))}),a(1," star "),t()}if(i&2){let e=o.index,r=c(3);E("text-warning",r.ratingValue>=e+1)("text-muted",r.ratingValue<e+1)}}function ue(i,o){i&1&&(n(0,"div",47),a(1," Please select a rating "),t())}function ge(i,o){i&1&&(u(0,"span",39),a(1," Submitting... "))}function _e(i,o){i&1&&a(0," Submit Rating ")}function be(i,o){if(i&1){let e=v();n(0,"div",35)(1,"h5",40),a(2,"Rate this Beneficiary"),t(),m(3,se,4,0,"div",41)(4,pe,4,1,"div",42),n(5,"form",43),y("ngSubmit",function(){b(e);let d=c(2);return x(d.submitRating(d.beneficiary.id))}),n(6,"div",24)(7,"label",44),a(8,"Rating"),t(),n(9,"div",45),m(10,fe,2,4,"span",46),t(),m(11,ue,2,0,"div",47),t(),n(12,"div",48)(13,"label",49),a(14,"Comment (optional)"),t(),u(15,"textarea",50),t(),n(16,"div",51)(17,"button",52),m(18,ge,2,0)(19,_e,1,0),t()()()()}if(i&2){let e,r=c(2);l(3),s(r.ratingSuccess?3:-1),l(),s(r.ratingError?4:-1),l(),f("formGroup",r.ratingForm),l(5),f("ngForOf",w(7,ie)),l(),s(r.submitted&&((e=r.ratingForm.get("rating"))!=null&&e.errors)?11:-1),l(6),f("disabled",r.submittingRating),l(),s(r.submittingRating?18:19)}}function xe(i,o){i&1&&(n(0,"div",36)(1,"span",56),a(2,"login"),t(),n(3,"h5"),a(4,"No ratings yet"),t(),n(5,"p",16),a(6,"Be the first to rate this beneficiary"),t()())}function ve(i,o){if(i&1&&(n(0,"span",65),a(1,"star"),t()),i&2){let e=o.$implicit,r=c().$implicit;E("text-muted",e>r.value)}}function ye(i,o){if(i&1&&(n(0,"p",64),a(1),t()),i&2){let e=c().$implicit;l(),p(e.comment)}}function he(i,o){if(i&1&&(n(0,"div",57)(1,"div",58)(2,"div",59)(3,"div")(4,"h6",60),a(5),t(),n(6,"span",61),a(7),B(8,"date"),t()(),n(9,"div",62),m(10,ve,2,2,"span",63),t()(),m(11,ye,2,1,"p",64),t()()),i&2){let e=o.$implicit;l(5),p(e.raterName),l(2),p(D(8,4,e.createdAt,"MMM d, yyyy")),l(3),f("ngForOf",w(7,ie)),l(),s(e.comment?11:-1)}}function Ce(i,o){if(i&1&&(n(0,"div",37),k(1,he,12,8,"div",57,re),t()),i&2){let e=c(2);l(),O(e.beneficiary.ratings)}}function Se(i,o){if(i&1&&(n(0,"div",3)(1,"div",6)(2,"div",7)(3,"span",8),a(4,"account_circle"),t(),n(5,"div",9)(6,"div",10)(7,"span",8),a(8,"account_circle"),t()(),n(9,"h3",11),a(10),t(),n(11,"p",12),a(12),t()()(),n(13,"div",13)(14,"div",14)(15,"h5",15),a(16,"Contact Information"),t(),n(17,"span",16),a(18),t()()(),n(19,"div",17),m(20,me,3,2,"button",18),n(21,"a",19)(22,"span",20),a(23,"add"),t(),a(24," Add New Beneficiary "),t(),n(25,"a",21)(26,"span",20),a(27,"arrow_back"),t(),a(28," Back to List "),t()()(),n(29,"div",22)(30,"div",23)(31,"div",14)(32,"h5",15),a(33,"Contact Information"),t(),n(34,"div",24)(35,"div",25)(36,"span",26),a(37,"email"),t(),n(38,"div")(39,"div",27),a(40,"Email"),t(),n(41,"div"),a(42),t()()(),n(43,"div",28)(44,"span",26),a(45,"phone"),t(),n(46,"div")(47,"div",27),a(48,"Phone"),t(),n(49,"div"),a(50),t()()()()()(),n(51,"div",13)(52,"div",14)(53,"h5",15),a(54,"Performance Metrics"),t(),n(55,"div",24)(56,"label",29)(57,"span"),a(58,"Budget"),t(),n(59,"span",30),a(60),B(61,"number"),t()(),n(62,"div",31),u(63,"div",32),t()(),n(64,"div")(65,"label",29)(66,"span"),a(67,"Power"),t(),n(68,"span",30),a(69),t()(),n(70,"div",31),u(71,"div",33),t()()()()(),n(72,"div",22)(73,"div",23)(74,"div",14)(75,"h4",34),a(76,"Ratings & Reviews"),t(),m(77,be,20,8,"div",35)(78,xe,7,0,"div",36)(79,Ce,3,0,"div",37),t()()()()),i&2){let e,r=c();l(10),p(r.beneficiary.name),l(2),A(" ",r.beneficiary.gender,", ",r.beneficiary.age," years "),l(6),g("(",r.beneficiary.ratings.length,")"),l(2),s(!r.beneficiary.isApproved&&r.authService.isAdmin()?20:-1),l(22),p(r.beneficiary.email),l(8),p(r.beneficiary.phone),l(10),g("$",D(61,15,r.beneficiary.budget,"1.0-0"),""),l(3),S("width",r.beneficiary.budget/1e4*100+"%"),l(6),g("",r.beneficiary.power,"%"),l(2),S("width",r.beneficiary.power+"%"),l(6),s(r.authService.isAuthenticated()&&((e=r.authService.currentUser())==null?null:e.id)!==r.beneficiary.id?77:-1),l(),s(r.beneficiary.ratings.length===0?78:79)}}var te=class i{route=_(L);beneficiaryService=_(U);fb=_(Z);authService=_(q);beneficiary=null;loading=!0;error="";beneficiarySubscription;ratingForm;ratingValue=0;submitted=!1;submittingRating=!1;ratingSuccess=!1;ratingError="";approving=!1;ratingInput;constructor(){this.ratingForm=this.fb.group({rating:[0,[h.required,h.min(1),h.max(5)]],comment:[""]})}ngOnInit(){console.log("Detail component initialized - starting data fetch"),this.loadBeneficiary()}ngOnDestroy(){this.beneficiarySubscription&&this.beneficiarySubscription.unsubscribe()}loadBeneficiary(){this.loading=!0,this.error="",console.log("Detail loading set to true"),this.beneficiarySubscription&&this.beneficiarySubscription.unsubscribe();let o=this.route.paramMap.pipe(I(e=>e.get("id")||""),C(e=>console.log("Detail component - received ID:",e)),R(e=>{if(!e)throw new Error("Beneficiary ID is required");return console.log("Detail component - fetching beneficiary with ID:",e),this.beneficiaryService.getBeneficiaryById(e).pipe(C(r=>console.log("Detail component - received beneficiary data:",r)))}),T(e=>(console.error("Detail component - error fetching beneficiary:",e),this.loading=!1,this.error=e.message||"Failed to load beneficiary details",F(null))));this.beneficiarySubscription=o.subscribe({next:e=>{this.beneficiary=e,this.loading=!1,this.ratingSuccess=!1,this.ratingError="",console.log("Detail component - subscription received data, loading set to false")},error:e=>{console.error("Detail component - subscription error:",e),this.loading=!1,this.error=e.message||"Failed to load beneficiary details",this.beneficiary=null}}),setTimeout(()=>{this.loading&&(console.log("Detail component - timeout triggered - setting loading to false"),this.loading=!1)},5e3)}setRating(o){this.ratingValue=o,this.ratingForm.patchValue({rating:o})}submitRating(o){if(this.submitted=!0,this.ratingSuccess=!1,this.ratingError="",this.ratingForm.invalid)return;this.submittingRating=!0;let{rating:e,comment:r}=this.ratingForm.value;this.beneficiaryService.rateBeneficiary(o,e,r).subscribe({next:()=>{this.submittingRating=!1,this.ratingSuccess=!0,this.ratingForm.reset({rating:0,comment:""}),this.ratingValue=0,this.submitted=!1,this.loadBeneficiary()},error:d=>{this.submittingRating=!1,this.ratingError=d.message||"Failed to submit rating"}})}approveBeneficiary(o){this.approving=!0,this.beneficiaryService.approveBeneficiary(o).subscribe({next:()=>{this.approving=!1,this.loadBeneficiary()},error:e=>{this.approving=!1,this.error=e.message||"Failed to approve beneficiary"}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=V({type:i,selectors:[["app-beneficiary-detail"]],viewQuery:function(e,r){if(e&1&&P(ae,5),e&2){let d;M(d=N())&&(r.ratingInput=d.first)}},standalone:!0,features:[z],decls:4,vars:1,consts:[[1,"container","py-5","animate__animated","animate__fadeIn"],[1,"d-flex","justify-content-center","my-5"],["role","alert",1,"alert","alert-danger"],[1,"row"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"col-lg-4","mb-4","mb-lg-0"],[1,"card","shadow-sm","border-0","overflow-hidden","animate__animated","animate__zoomIn"],[1,"material-icons",2,"font-size","4rem"],[1,"card-body","text-center","p-4"],[1,"avatar-placeholder","mb-3","mx-auto","d-flex","align-items-center","justify-content-center","bg-primary","bg-opacity-10","rounded-circle",2,"width","120px","height","120px"],[1,"fw-bold","mb-1","text-primary"],[1,"text-muted","mb-3"],[1,"card","shadow-sm","border-0","mt-4"],[1,"card-body","p-4"],[1,"fw-bold","mb-3","text-primary"],[1,"text-muted"],[1,"d-grid","gap-2"],[1,"btn","btn-success",3,"disabled"],["routerLink","/admin/beneficiaries/add",1,"btn","btn-primary"],[1,"material-icons","me-2"],["routerLink","/admin/beneficiaries",1,"btn","btn-outline-primary"],[1,"col-lg-8"],[1,"card","shadow-sm","border-0","mb-4"],[1,"mb-3"],[1,"d-flex","align-items-center","gap-3","mb-3","transition-hover",2,"transition","transform 0.2s ease-in-out"],[1,"material-icons","me-2","text-primary","bg-primary","bg-opacity-10","rounded-circle","p-2"],[1,"text-muted","small"],[1,"d-flex","align-items-center","gap-3"],[1,"form-label","d-flex","justify-content-between"],[1,"fw-bold"],[1,"progress","rounded-pill","overflow-hidden"],["role","progressbar","aria-valuenow","beneficiary.budget","aria-valuemin","0","aria-valuemax","10000",1,"progress-bar","bg-success"],["role","progressbar","aria-valuenow","beneficiary.power","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-primary"],[1,"fw-bold","mb-4","text-primary"],[1,"mb-4","p-4","bg-light","rounded-3","shadow-sm"],["role","alert",1,"alert","alert-warning","text-center","py-4","rounded-3"],[1,"ratings-list"],[1,"btn","btn-success",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"mb-3","text-primary"],["role","alert",1,"alert","alert-success","d-flex","align-items-center","py-3","px-4","rounded-3"],["role","alert",1,"alert","alert-danger","py-3","px-4","rounded-3"],[3,"ngSubmit","formGroup"],[1,"form-label"],[1,"rating-input","d-flex"],["class","material-icons cursor-pointer","style","font-size: 2rem;",3,"text-warning","text-muted","click",4,"ngFor","ngForOf"],[1,"text-danger","mt-1"],[1,"mb-3","mt-2"],["for","comment",1,"form-label"],["id","comment","formControlName","comment","rows","3","placeholder","Share your experience with this beneficiary...",1,"form-control"],[1,"d-grid","mt-3"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"material-icons","me-2","text-success",2,"font-size","1.5rem"],[1,"material-icons","me-2","text-danger",2,"font-size","1.5rem"],[1,"material-icons","cursor-pointer",2,"font-size","2rem",3,"click"],[1,"material-icons","d-block","mb-3","text-warning",2,"font-size","3rem"],[1,"card","mb-3"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-3","border-bottom","pb-2"],[1,"mb-0","fw-bold"],[1,"text-muted","small","badge","bg-light","text-dark"],[1,"d-flex"],["class","material-icons text-warning me-1",3,"text-muted",4,"ngFor","ngForOf"],[1,"mb-0"],[1,"material-icons","text-warning","me-1"]],template:function(e,r){e&1&&(n(0,"div",0),m(1,oe,4,0,"div",1)(2,le,2,1,"div",2)(3,Se,80,18,"div",3),t()),e&2&&(l(),s(r.loading?1:r.error?2:r.beneficiary?3:-1))},dependencies:[$,Q,ee,K,Y,H,J,W,X,j,G],styles:[".avatar-placeholder[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;background-color:#e9ecef;display:flex;align-items:center;justify-content:center;margin:0 auto;color:#6c757d}.progress[_ngcontent-%COMP%]{height:10px}.rating-input[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{transition:all .2s ease}.rating-input[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]:hover{transform:scale(1.2)}"]})};export{te as BeneficiaryDetailComponent};
