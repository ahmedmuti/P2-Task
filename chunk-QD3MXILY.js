import{b as Y,d as q,f as G,q as H}from"./chunk-UDLBRQ3V.js";import{b as J}from"./chunk-SN6GRNMG.js";import{$ as o,A as k,Ca as V,E as a,Fa as W,Ga as $,Ia as z,J as d,L as c,S as n,T as t,V as D,W as g,X as m,aa as S,ba as f,c as C,da as N,e as B,ea as j,fa as M,g as x,ha as O,i as I,ja as v,l as E,m as L,n as _,u as b,v as T,va as A,wa as P,xa as R,z as F}from"./chunk-NIPSTPOT.js";var w=e=>({active:e}),Q=e=>["/beneficiaries",e];function U(e,s){e&1&&(n(0,"a",21)(1,"span",22),o(2,"add"),t(),o(3," Add New Beneficiary "),t())}function X(e,s){if(e&1){let i=D();n(0,"button",23),g("click",function(){F(i);let l=m();return k(l.clearSearch())}),n(1,"span",12),o(2,"close"),t()()}}function Z(e,s){if(e&1&&(n(0,"span",24),o(1),t()),e&2){let i=m();a(),f(" ",i.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ee(e,s){if(e&1&&(n(0,"span",24),o(1),t()),e&2){let i=m();a(),f(" ",i.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ie(e,s){if(e&1&&(n(0,"span",24),o(1),t()),e&2){let i=m();a(),f(" ",i.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function te(e,s){e&1&&(n(0,"div",25)(1,"div",26)(2,"span",27),o(3,"Loading..."),t()()())}function ne(e,s){e&1&&(n(0,"div",30)(1,"span",31),o(2,"search_off"),t(),n(3,"h4"),o(4,"No beneficiaries found"),t(),n(5,"p",32),o(6,"Try adjusting your search criteria"),t()())}function re(e,s){e&1&&(n(0,"span",48),o(1,"star"),t())}function ae(e,s){if(e&1&&(n(0,"span",3),o(1),t()),e&2){let i=m().$implicit;a(),S(i.averageRating)}}function oe(e,s){if(e&1&&(n(0,"span",4),o(1),t()),e&2){let i=m().$implicit;a(),f("(",i.ratings.length,")")}}function se(e,s){e&1&&(n(0,"span",4),o(1,"Not rated"),t())}function ce(e,s){if(e&1&&(n(0,"div",35)(1,"div",36)(2,"div",8)(3,"div",37)(4,"h5",38),o(5),t(),n(6,"span",39),o(7),t()(),n(8,"div",40)(9,"div",41)(10,"span",4),o(11,"Budget:"),t(),n(12,"span",3),o(13),t()(),n(14,"div",41)(15,"span",4),o(16,"Power:"),t(),n(17,"span",3),o(18),t()(),n(19,"div",42)(20,"span",4),o(21,"Rating:"),t(),n(22,"div"),d(23,re,2,0,"span",43)(24,ae,2,1,"span",44)(25,oe,2,1,"span",45)(26,se,2,0,"span",45),t()()(),n(27,"div",46)(28,"a",47),o(29," View Profile "),t()()()()()),e&2){let i=s.$implicit;a(5),S(i.name),a(),c("ngClass",i.isApproved?"bg-success":"bg-warning"),a(),f(" ",i.isApproved?"Approved":"Pending"," "),a(6),f("$",i==null?null:i.budget,""),a(5),f("",i.power,"%"),a(5),c("ngIf",i.averageRating>0),a(),c("ngIf",i.averageRating>0),a(),c("ngIf",i.averageRating>0),a(),c("ngIf",i.averageRating<=0),a(2),c("routerLink",v(10,Q,i.id))}}function le(e,s){if(e&1&&(n(0,"div",33),d(1,ce,30,12,"div",34),t()),e&2){let i=m(2);a(),c("ngForOf",i.beneficiaries)("ngForTrackBy",i.trackById)}}function de(e,s){if(e&1&&(n(0,"div"),d(1,ne,7,0,"div",28)(2,le,2,2,"div",29),t()),e&2){let i=m();a(),c("ngIf",i.beneficiaries.length===0),a(),c("ngIf",i.beneficiaries.length>0)}}var K=class e{beneficiaryService=b(J);authService=b(z);router=b(W);beneficiaries=[];loading=!0;searchTerm="";sortField="name";sortDirection="asc";searchSubject=new C;navigationSubscription;beneficiariesSubscription;ngOnInit(){console.log("Component initialized - starting data fetch"),this.initBeneficiariesStream(),this.navigationSubscription=this.router.events.subscribe(s=>{s instanceof V&&s.url.includes("/beneficiaries")&&(console.log("Navigation to beneficiaries detected - reinitializing data"),this.initBeneficiariesStream())})}ngOnDestroy(){this.navigationSubscription&&this.navigationSubscription.unsubscribe(),this.beneficiariesSubscription&&this.beneficiariesSubscription.unsubscribe()}initBeneficiariesStream(){this.beneficiariesSubscription&&this.beneficiariesSubscription.unsubscribe();let s=this.searchSubject.pipe(E({term:this.searchTerm,field:this.sortField,direction:this.sortDirection}),_(r=>console.log("Search params updated:",r)));this.loading=!0,console.log("Loading set to true");let i=s.pipe(_(()=>console.log("Processing search params")),L(r=>(console.log("Fetching beneficiaries with params:",r),this.beneficiaryService.getApprovedBeneficiaries().pipe(_(l=>console.log("Raw beneficiaries data received:",l)),x(l=>{let p=l.filter(u=>u.name.toLowerCase().includes(r.term.toLowerCase())||u.email.toLowerCase().includes(r.term.toLowerCase()));return console.log("Beneficiaries after filter:",p),p}),x(l=>{let p=[...l].sort((u,y)=>{let h=r.direction==="asc"?1:-1;return r.field==="name"?u.name.localeCompare(y.name)*h:r.field==="budget"?(Number(u.budget)-Number(y.budget))*h:r.field==="power"?(Number(u.power)-Number(y.power))*h:0});return console.log("Beneficiaries after sort:",p),p}),I(l=>(console.error("Error fetching beneficiaries:",l),B([{id:"1",name:"John Doe",email:"john@example.com",budget:1e3,power:50,isApproved:!0,averageRating:4.5},{id:"2",name:"Jane Smith",email:"jane@example.com",budget:2e3,power:75,isApproved:!0,averageRating:3.8}])))))));this.beneficiariesSubscription=i.subscribe({next:r=>{console.log("Subscription received data:",r),this.beneficiaries=r,this.loading=!1},error:r=>{console.error("Subscription error:",r),this.loading=!1,this.beneficiaries=[]}}),setTimeout(()=>{console.log("Timeout triggered - setting loading to false"),this.loading=!1},1e3)}onSearchChange(){this.searchSubject.next({term:this.searchTerm,field:this.sortField,direction:this.sortDirection})}clearSearch(){this.searchTerm="",this.onSearchChange()}sortBy(s){this.sortField===s?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=s,this.sortDirection="asc"),this.onSearchChange()}trackById(s,i){return i.id}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=T({type:e,selectors:[["app-beneficiary-list"]],standalone:!0,features:[O],decls:33,vars:17,consts:[[1,"container","py-5"],[1,"row","mb-4"],[1,"col-md-6"],[1,"fw-bold"],[1,"text-muted"],[1,"col-md-6","d-flex","justify-content-md-end","align-items-center"],["routerLink","/admin/beneficiaries/add","class","btn btn-primary",4,"ngIf"],[1,"card","shadow-sm","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"input-group"],[1,"input-group-text","bg-light"],[1,"material-icons"],["type","text","placeholder","Search beneficiaries...",1,"form-control",3,"ngModelChange","input","ngModel"],["class","btn btn-outline-secondary","type","button",3,"click",4,"ngIf"],[1,"d-flex","justify-content-md-end"],[1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"click","ngClass"],["class","material-icons ms-1 small",4,"ngIf"],["class","d-flex justify-content-center my-5",4,"ngIf"],[4,"ngIf"],["routerLink","/admin/beneficiaries/add",1,"btn","btn-primary"],[1,"material-icons","me-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"material-icons","ms-1","small"],[1,"d-flex","justify-content-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["class","alert alert-info text-center py-5","role","alert",4,"ngIf"],["class","row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4",4,"ngIf"],["role","alert",1,"alert","alert-info","text-center","py-5"],[1,"material-icons","d-block","mb-3",2,"font-size","3rem"],[1,"mb-0"],[1,"row","row-cols-1","row-cols-md-2","row-cols-lg-3","g-4"],["class","col",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col"],[1,"card","h-100","shadow-sm","hover-card"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"card-title","mb-0","fw-bold"],[1,"badge","rounded-pill",3,"ngClass"],[1,"mb-3"],[1,"d-flex","justify-content-between","mb-2"],[1,"d-flex","justify-content-between"],["class","material-icons text-warning",4,"ngIf"],["class","fw-bold",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"d-grid"],[1,"btn","btn-outline-primary",3,"routerLink"],[1,"material-icons","text-warning"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"Beneficiaries"),t(),n(5,"p",4),o(6,"Browse all registered beneficiaries"),t()(),n(7,"div",5),d(8,U,4,0,"a",6),t()(),n(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",2)(13,"div",10)(14,"span",11)(15,"span",12),o(16,"search"),t()(),n(17,"input",13),M("ngModelChange",function(p){return j(r.searchTerm,p)||(r.searchTerm=p),p}),g("input",function(){return r.onSearchChange()}),t(),d(18,X,3,0,"button",14),t()(),n(19,"div",2)(20,"div",15)(21,"div",16)(22,"button",17),g("click",function(){return r.sortBy("name")}),o(23," Name "),d(24,Z,2,1,"span",18),t(),n(25,"button",17),g("click",function(){return r.sortBy("budget")}),o(26," Budget "),d(27,ee,2,1,"span",18),t(),n(28,"button",17),g("click",function(){return r.sortBy("power")}),o(29," Power "),d(30,ie,2,1,"span",18),t()()()()()()(),d(31,te,4,0,"div",19)(32,de,3,2,"div",20),t()),i&2&&(a(8),c("ngIf",r.authService.isAdmin()),a(9),N("ngModel",r.searchTerm),a(),c("ngIf",r.searchTerm),a(4),c("ngClass",v(11,w,r.sortField==="name")),a(2),c("ngIf",r.sortField==="name"),a(),c("ngClass",v(13,w,r.sortField==="budget")),a(2),c("ngIf",r.sortField==="budget"),a(),c("ngClass",v(15,w,r.sortField==="power")),a(2),c("ngIf",r.sortField==="power"),a(),c("ngIf",r.loading),a(),c("ngIf",!r.loading))},dependencies:[$,H,Y,q,G,A,R,P],styles:[".hover-card[_ngcontent-%COMP%]{transition:transform .3s ease,box-shadow .3s ease}.hover-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.badge[_ngcontent-%COMP%]{font-weight:500;padding:.5em .8em}"]})};export{K as BeneficiaryListComponent};
