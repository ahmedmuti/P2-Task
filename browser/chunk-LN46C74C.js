import{b as J,d as K,f as Q,q as U}from"./chunk-UDLBRQ3V.js";import{b as H}from"./chunk-SN6GRNMG.js";import{$ as a,A as C,Aa as q,E as o,Ga as G,J as p,L as c,N as M,S as r,T as i,U as N,V as S,W as u,X as d,aa as g,ba as _,c as A,da as O,e as T,ea as j,fa as V,g as B,ha as $,i as L,ja as b,l as k,la as w,m as F,n as h,na as E,u as P,v as D,va as R,wa as z,xa as W,z as x}from"./chunk-NIPSTPOT.js";var I=t=>({active:t}),Y=t=>["/beneficiaries",t];function Z(t,s){if(t&1){let e=S();r(0,"button",22),u("click",function(){x(e);let l=d();return C(l.clearSearch())}),r(1,"span",13),a(2,"close"),i()()}}function ee(t,s){if(t&1&&(r(0,"span",23),a(1),i()),t&2){let e=d();o(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function te(t,s){if(t&1&&(r(0,"span",23),a(1),i()),t&2){let e=d();o(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ie(t,s){if(t&1&&(r(0,"span",23),a(1),i()),t&2){let e=d();o(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ne(t,s){t&1&&(r(0,"div",24)(1,"div",25)(2,"span",26),a(3,"Loading..."),i()()())}function re(t,s){t&1&&(r(0,"div",28)(1,"span",29),a(2,"search_off"),i(),r(3,"h4"),a(4,"No beneficiaries found"),i(),r(5,"p",30),a(6,"Try adjusting your search criteria"),i()())}function ae(t,s){if(t&1&&(r(0,"div",45)(1,"span",46),a(2,"star"),i(),r(3,"span"),a(4),w(5,"number"),i()()),t&2){let e=d().$implicit;o(4),g(E(5,1,e.averageRating,"1.1-1"))}}function oe(t,s){t&1&&(r(0,"span",4),a(1,"Not rated"),i())}function se(t,s){t&1&&N(0,"span",50)}function ce(t,s){t&1&&(r(0,"span",13),a(1,"check_circle"),i())}function le(t,s){if(t&1){let e=S();r(0,"button",47),u("click",function(){x(e);let l=d().$implicit,m=d(3);return C(m.approveBeneficiary(l.id))}),p(1,se,1,0,"span",48)(2,ce,2,0,"span",49),i()}if(t&2){let e=d().$implicit,n=d(3);c("disabled",n.approvingId===e.id),o(),c("ngIf",n.approvingId===e.id),o(),c("ngIf",n.approvingId!==e.id)}}function de(t,s){if(t&1&&(r(0,"tr")(1,"td"),a(2),i(),r(3,"td"),a(4),i(),r(5,"td"),a(6),w(7,"number"),i(),r(8,"td"),a(9),i(),r(10,"td")(11,"span",39),a(12),i()(),r(13,"td"),p(14,ae,6,4,"div",40)(15,oe,2,0,"span",41),i(),r(16,"td")(17,"div",42)(18,"a",43)(19,"span",13),a(20,"visibility"),i()(),p(21,le,3,3,"button",44),i()()()),t&2){let e=s.$implicit;o(2),g(e.name),o(2),g(e.email),o(2),_("$",E(7,10,e.budget,"1.0-0"),""),o(3),_("",e.power,"%"),o(2),c("ngClass",e.isApproved?"bg-success":"bg-warning"),o(),_(" ",e.isApproved?"Approved":"Pending"," "),o(2),c("ngIf",e.averageRating>0),o(),c("ngIf",e.averageRating<=0),o(3),c("routerLink",b(13,Y,e.id)),o(3),c("ngIf",!e.isApproved)}}function me(t,s){if(t&1){let e=S();r(0,"li",51)(1,"a",52),u("click",function(l){let m=x(e).$implicit,f=d(3);return C(f.goToPage(m,l))}),a(2),i()()}if(t&2){let e=s.$implicit,n=d(3);M("active",n.currentPage===e),o(2),g(e)}}function pe(t,s){if(t&1&&(r(0,"div")(1,"div",31)(2,"table",32)(3,"thead",33)(4,"tr")(5,"th"),a(6,"Name"),i(),r(7,"th"),a(8,"Email"),i(),r(9,"th"),a(10,"Budget"),i(),r(11,"th"),a(12,"Power"),i(),r(13,"th"),a(14,"Status"),i(),r(15,"th"),a(16,"Rating"),i(),r(17,"th"),a(18,"Actions"),i()()(),r(19,"tbody"),p(20,de,22,15,"tr",34),i()()(),r(21,"div",35)(22,"nav",36)(23,"ul",37),p(24,me,3,3,"li",38),i()()()()),t&2){let e=d(2);o(20),c("ngForOf",e.beneficiaries)("ngForTrackBy",e.trackById),o(4),c("ngForOf",e.paginationPages)}}function fe(t,s){if(t&1&&(r(0,"div"),p(1,re,7,0,"div",27)(2,pe,25,3,"div",21),i()),t&2){let e=d();o(),c("ngIf",e.beneficiaries.length===0),o(),c("ngIf",e.beneficiaries.length>0)}}var X=class t{beneficiaryService=P(H);beneficiaries=[];searchSubject=new A;beneficiariesSubscription;loading=!0;searchTerm="";sortField="name";sortDirection="asc";approvingId=null;currentPage=1;paginationPages=[1,2,3,4,5];ngOnInit(){console.log("Admin component initialized - starting data fetch"),this.initBeneficiariesStream()}ngOnDestroy(){this.beneficiariesSubscription&&this.beneficiariesSubscription.unsubscribe()}initBeneficiariesStream(){this.beneficiariesSubscription&&this.beneficiariesSubscription.unsubscribe(),this.loading=!0,console.log("Admin loading set to true");let e=this.searchSubject.pipe(k({term:this.searchTerm,field:this.sortField,direction:this.sortDirection}),h(n=>console.log("Admin search params updated:",n))).pipe(h(()=>console.log("Processing admin search params")),F(n=>(console.log("Fetching admin beneficiaries with params:",n),this.beneficiaryService.getAllBeneficiaries().pipe(h(l=>console.log("Raw admin beneficiaries data received:",l)),B(l=>{let m=n.term?l.filter(f=>f.name.toLowerCase().includes(n.term.toLowerCase())||f.email.toLowerCase().includes(n.term.toLowerCase())):l;return console.log("Admin beneficiaries after filter:",m),m}),B(l=>{let m=[...l].sort((f,v)=>{let y=n.direction==="asc"?1:-1;return n.field==="name"?f.name.localeCompare(v.name)*y:n.field==="email"?f.email.localeCompare(v.email)*y:n.field==="budget"?(Number(f.budget)-Number(v.budget))*y:n.field==="power"?(Number(f.power)-Number(v.power))*y:0});return console.log("Admin beneficiaries after sort:",m),m}),L(l=>(console.error("Error fetching admin beneficiaries:",l),T([])))))));this.beneficiariesSubscription=e.subscribe({next:n=>{console.log("Admin subscription received data:",n),this.beneficiaries=n,this.loading=!1},error:n=>{console.error("Admin subscription error:",n),this.loading=!1,this.beneficiaries=[]}}),setTimeout(()=>{console.log("Admin timeout triggered - setting loading to false"),this.loading=!1},5e3)}onSearchChange(){this.searchSubject.next({term:this.searchTerm,field:this.sortField,direction:this.sortDirection})}clearSearch(){this.searchTerm="",this.onSearchChange()}sortBy(s){this.sortField===s?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=s,this.sortDirection="asc"),this.onSearchChange()}approveBeneficiary(s){this.approvingId=s,this.beneficiaryService.approveBeneficiary(s).subscribe({next:()=>{this.approvingId=null,this.initBeneficiariesStream()},error:e=>{console.error("Error approving beneficiary",e),this.approvingId=null}})}trackById(s,e){return e.id}goToPage(s,e){e.preventDefault(),this.currentPage=s}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=D({type:t,selectors:[["app-admin-beneficiary-list"]],standalone:!0,features:[$],decls:36,vars:16,consts:[[1,"container","py-5"],[1,"row","mb-4"],[1,"col-md-6"],[1,"fw-bold"],[1,"text-muted"],[1,"col-md-6","d-flex","justify-content-md-end","align-items-center"],["routerLink","/admin/beneficiaries/add",1,"btn","btn-primary"],[1,"material-icons","me-2"],[1,"card","shadow-sm","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"input-group"],[1,"input-group-text","bg-light"],[1,"material-icons"],["type","text","placeholder","Search beneficiaries...",1,"form-control",3,"ngModelChange","input","ngModel"],["class","btn btn-outline-secondary","type","button",3,"click",4,"ngIf"],[1,"d-flex","justify-content-md-end"],[1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"click","ngClass"],["class","material-icons ms-1 small",4,"ngIf"],["class","d-flex justify-content-center my-5",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"material-icons","ms-1","small"],[1,"d-flex","justify-content-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["class","alert alert-info text-center py-5","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-info","text-center","py-5"],[1,"material-icons","d-block","mb-3",2,"font-size","3rem"],[1,"mb-0"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","justify-content-center","mt-4"],["aria-label","Page navigation"],[1,"pagination"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"badge","rounded-pill",3,"ngClass"],["class","d-flex align-items-center",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"d-flex"],["title","View Details",1,"btn","btn-sm","btn-outline-primary","me-2",3,"routerLink"],["class","btn btn-sm btn-outline-success","title","Approve Beneficiary",3,"disabled","click",4,"ngIf"],[1,"d-flex","align-items-center"],[1,"material-icons","text-warning","me-1",2,"font-size","1rem"],["title","Approve Beneficiary",1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","material-icons",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"page-item"],["href","#",1,"page-link",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Manage Beneficiaries"),i(),r(5,"p",4),a(6,"Admin dashboard for beneficiary management"),i()(),r(7,"div",5)(8,"a",6)(9,"i",7),a(10,"add"),i(),a(11," Add New Beneficiary "),i()()(),r(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",2)(16,"div",11)(17,"span",12)(18,"span",13),a(19,"search"),i()(),r(20,"input",14),V("ngModelChange",function(m){return j(n.searchTerm,m)||(n.searchTerm=m),m}),u("input",function(){return n.onSearchChange()}),i(),p(21,Z,3,0,"button",15),i()(),r(22,"div",2)(23,"div",16)(24,"div",17)(25,"button",18),u("click",function(){return n.sortBy("name")}),a(26," Name "),p(27,ee,2,1,"span",19),i(),r(28,"button",18),u("click",function(){return n.sortBy("budget")}),a(29," Budget "),p(30,te,2,1,"span",19),i(),r(31,"button",18),u("click",function(){return n.sortBy("power")}),a(32," Power "),p(33,ie,2,1,"span",19),i()()()()()()(),p(34,ne,4,0,"div",20)(35,fe,3,2,"div",21),i()),e&2&&(o(20),O("ngModel",n.searchTerm),o(),c("ngIf",n.searchTerm),o(4),c("ngClass",b(10,I,n.sortField==="name")),o(2),c("ngIf",n.sortField==="name"),o(),c("ngClass",b(12,I,n.sortField==="budget")),o(2),c("ngIf",n.sortField==="budget"),o(),c("ngClass",b(14,I,n.sortField==="power")),o(2),c("ngIf",n.sortField==="power"),o(),c("ngIf",n.loading),o(),c("ngIf",!n.loading))},dependencies:[R,G,U,J,K,Q,q,W,z],styles:[".badge[_ngcontent-%COMP%]{font-weight:500;padding:.5em .8em}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600}.material-icons[_ngcontent-%COMP%]{font-size:1.1rem}"]})};export{X as AdminBeneficiaryListComponent};
